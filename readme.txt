FGOSCCNT ver0.2.0 2020/4/3

Twitter @fgophi

FGOスクショからアイテムをCSV出力する

【必要なソフトウェア】
Python 3.7以降

【必要なライブラリ】
OpenCV
pageinfo.py https://github.com/max747/fgojunks/blob/master/pageinfo/pageinfo.py


【ファイル】
1. fgosccnt.py :実行ファイル
2. makeitem.py item.xml を作成
3. makechest.py chest.xml を作成
4. makecard.py card.xml を作成
5. data フォルダ 2.3.4.で用いられるファイル
6. csv2counter.py (おまけ)fgosccnt.pyの出力CSVをFGO周回カウンタ書式にする
7. qpsplit.py (おまけ)スクショファイルを報酬QPごとにフォルダ分けする

以下は2.3.4.実行時に作成される
8. item.xml: アイテム下部の文字を読むSVMのトレーニングファイル
9. chest.xml:  ドロップ数の文字を読むSVMのトレーニングファイル
10. card.xml:  カード下部の文字を読むSVMのトレーニングファイル

【インストール】
・OpenCV をインストール
・pageinfo.py を fgosccnt.py と同一フォルダ等に置く
・makeitem.py, makechest.py, makecard.py をそれぞれ実行

※fgosccnt.py, item.xml chest.xml card.xmlを同じフォルダにいれること


【使い方】
usage: fgosccnt.py [-h] [--version] [filenames [filenames ...]]

FGOスクショからアイテムをCSV出力する

positional arguments:
  filenames   入力ファイル

optional arguments:
  -h, --help  show this help message and exit
  --version   show program's version number and exit

【実行方法】
python fgosccnt.py ファイル1 ファイル2... > output.csv

【結果(例1)】
filename,宝箱数,item000001+1900,item000002x3,item000003x3,item000004
合計,26,3,3,22,1
IMG_2065.PNG,10,1,2,8,
IMG_2066.PNG,9,1,1,7,1
IMG_2067.PNG,7,1,,7,

【結果(例2)】
filename,宝箱数,QP+1900,薬草x3,麦袋x3,騎ピ
合計,26,3,3,22,1
IMG_2065.PNG,10,1,2,8,
IMG_2066.PNG,9,1,1,7,1
IMG_2067.PNG,7,1,,7,

・Ver0.7より戦利品下部に数字が書かれている場合、その数字を認識して出力する
(ただしボーナス表記は省かれる)
そのため例えばQP+1000とQP+1500は同じitemファイル1つで認識される
・item フォルダにできるファイル.pngのファイル名をアイテム名に変更すると次回実行以降もそのアイテム名で表示されるため例2のように出力され可読性があがる
・自動変換された種火と自動変換されない種火を同じアイテムとして認識したい場合はフォルダを分けて同じ名前のアイテムファイルにすれば同じ名前でカウントされる
・全く同じアイテムで別ファイルができる場合があるが、フォルダを分けて同じ名前のアイテムファイルにすれば同じものとしてカウントされる

【制限】
2560x1600, 2436x1125, 2208x1242,2048x1536, 1920x1200, 1334x750の解像度のみ対応
・全く同じアイテムでも複数のアイテムファイルが作成されることがごく稀にある
・特に低解像度のスクショやJPEG化などの劣化があると誤動作しやすいのでPNGのままの使用を推奨
・騎業火はデータが無いためおそらく誤認識される

【リリースノート】

ver0.2
・白文字OCRの品質改善
・秘石・輝石の誤認識対策
・種火の誤認識対策
・ドロップ数表記無しイベントアイテムの誤認識対策
・戦利品順番ルールにより正しく近づける修正

ver0.1.2
・戦利品の順番ルールのより厳密な実行(概念礼装のレアリティは考慮されない)

ver0.1.1
・マスターミッションの情報ウィンドウのせいでドロップ数が読めないバグの修正
・XMLファイルの容量が大きいため、GitHubで扱いづらいのでmakeitem.py makechest.pyで使用者が作成するよう変更

ver0.1.0
・pyocr、Tesseract OCR、pillowが必要なくなった
・解像度ごとに実行環境を分ける必要が無くなった
・一度の実行で複数の解像度のスクショの処理ができるようになった
・常設アイテム名を自動で認識するようになった
・出力CSVは常設アイテムに関しては戦利品の順番ルールに従って出力されるようになった
・複数ファイルを認識させたときに2ページ以上になるもので2ページ目以降が無い場合missing行を出力するようになった

ver0.0.7
・戦利品の下部の数字を読んで出力できるようにした

ver0.0.6
・アイテム枠を認識しないスクショに対応した調整
・宝箱数や合計数を出力するように変更
・宝箱数21以上の4列以上になる戦利品のスクショに対応

ver0.0.5
・アイテム枠を認識しないスクショに対応した調整
・同じアイテムで違う数値の場合の誤認識の改善
・Windows環境で1行置きに空行が入ってしまう問題の修正

ver0.0.4
・画像マッチ方法の修正による認識率向上
・高速化
・item ディレクトリは必ず実行ファイルのあるディレクトリから探すように変更
・画像ファイルはitem ディレクトリのサブディレクトリも検索するように変更

